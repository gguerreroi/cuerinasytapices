<%
let Encabezado = encabezado != undefined ? encabezado : {
    codempleo: 0,
    datfchregistro: ''
}
let poaString = JSON.stringify(poa)
%>
<!DOCTYPE html>
<html lang="es">
<head>
    <%- include('../components/web-header') %>
    <style>
        tr {
            cursor: pointer;
        }
    </style>
</head>
<body id="kt_body"
      class="header-fixed header-tablet-and-mobile-fixed toolbar-enabled toolbar-fixed toolbar-tablet-and-mobile-fixed aside-enabled aside-fixed"
      style="--kt-toolbar-height:55px;--kt-toolbar-height-tablet-and-mobile:55px">
<div class="d-flex flex-column flex-root">
    <div class="page d-flex flex-row flex-column-fluid">
        <%- include('../components/left-aside.ejs') %>
        <div class="wrapper d-flex flex-column flex-row-fluid" id="kt_wrapper">
            <%- include('../components/kt-header.ejs') %>
            <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
                <div class="d-flex flex-column-fluid">
                    <div class="container">
                        <div class="row g-6">
                            <div class="col-12">
                                <div class="card gutter-b">
                                    <div class="card-header justify-content-end ribbon ribbon-start ribbon-clip">
                                        <div class="ribbon-label ">
                                            <%- Encabezado.codempleo || 0 %>
                                            <span class="ribbon-inner bg-primary"></span>
                                        </div>
                                        <div class="card-title"><h3 class="card-label">Registro de Empleos</h3></div>
                                        <div class="card-toolbar">
                                            <% if(id != 0) { %>
                                                <div class="btn-group">
                                                    <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-filetype-pdf" viewBox="0 0 16 16">
                                                            <path fill-rule="evenodd" d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM1.6 11.85H0v3.999h.791v-1.342h.803q.43 0 .732-.173.305-.175.463-.474a1.4 1.4 0 0 0 .161-.677q0-.375-.158-.677a1.2 1.2 0 0 0-.46-.477q-.3-.18-.732-.179m.545 1.333a.8.8 0 0 1-.085.38.57.57 0 0 1-.238.241.8.8 0 0 1-.375.082H.788V12.48h.66q.327 0 .512.181.185.183.185.522m1.217-1.333v3.999h1.46q.602 0 .998-.237a1.45 1.45 0 0 0 .595-.689q.196-.45.196-1.084 0-.63-.196-1.075a1.43 1.43 0 0 0-.589-.68q-.396-.234-1.005-.234zm.791.645h.563q.371 0 .609.152a.9.9 0 0 1 .354.454q.118.302.118.753a2.3 2.3 0 0 1-.068.592 1.1 1.1 0 0 1-.196.422.8.8 0 0 1-.334.252 1.3 1.3 0 0 1-.483.082h-.563zm3.743 1.763v1.591h-.79V11.85h2.548v.653H7.896v1.117h1.606v.638z"/>
                                                        </svg>
                                                    </button>
                                                    <ul class="dropdown-menu">
                                                        <li><button type="button" class="dropdown-item" onclick="window.location.href='/mye/empleos/reporte/<%- id %>'">Pantalla</button></li>
                                                        <li><button type="button" class="dropdown-item" onclick="window.location.href='/mye/empleos/pdf/<%- id %>'">PDF</button></li>
                                                    </ul>
                                                </div>
                                            <% } %>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <form class="row g-3" id="frmempleos">
                                            <div class="col-sm-12">
                                                <label class="input-group-text" for="fchregistro">Fecha</label>
                                                <input type="date" name="fchregistro" id="fchregistro" class="form-control" value="<%- Encabezado.datfchregistro %>" required>
                                            </div>
                                            <div class="col-sm-12">
                                                <label class="input-group-text" for="codactividad">Seleccionar la actividad del POA</label>
                                                <select name="codactividad" id="codactividad" class="form-control" multiple required>
                                                </select>
                                            </div>
                                            <% if (id != 0) { %>
                                            <%
                                                /*
                                                <div class="col-sm-12 col-md-6">
                                                    <label class="input-group-text">Tasa de cambio</label>
                                                    <input class="form-control" type="text" value=" empEncabezado.flttipocambio" disabled>
                                                </div> */
                                            %>
                                                <div class="col-sm-12 col-md-12">
                                                    <label class="input-group-text">Trimestre</label>
                                                    <input class="form-control" type="text" value="<%- Encabezado.strtrimestre_usaid %>" disabled>
                                                </div>
                                            <% } %>
                                            <div class="col-12">
                                                <button type="submit" id="kt_submit_frmempleos"
                                                        class="btn col-12 btn-success">
                                                    <span class="indicator-label">Guardar Encabezado</span>
                                                    <span class="indicator-progress">Procesando...
                                                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                                    </span>
                                                </button>
                                            </div>
                                        </form>
                                        <% if (id != 0) { %>
                                            <div class="row g-4 mt-4">
                                                <div class="separator"></div>
                                                <div class="table-responsive">
                                                    <table class="col-12 table table-bordered table-borderless table-sm" id="tb-empleoDetalle">
                                                        <thead class="fw-bolder">
                                                        <tr>
                                                            <th>#</th>
                                                            <th>Organización</th>
                                                            <th>Producto</th>
                                                            <th>Comunidad Lingüística</th>
                                                            <th>Mujeres<br>18 a 29<br>Jornales</th>
                                                            <th>Mujeres<br>>= 30 <br>Jornales</th>
                                                            <th>Mujeres<br>Total<br>Jornales</th>
                                                            <th>Mujeres<br>18 a 29<br>Temporales</th>
                                                            <th>Mujeres<br>>= 30 <br>Temporales</th>
                                                            <th>Mujeres<br>Total<br>Temporales</th>
                                                            <th>Mujeres<br>18 a 29<br>Permanentes</th>
                                                            <th>Mujeres<br> >= 30 <br>Permanentes</th>
                                                            <th>Mujeres<br>Total<br>Permanentes</th>
                                                            <th>Hombres<br>18 a 29<br>Jornales</th>
                                                            <th>Hombres<br> >= 30 <br>Jornales</th>
                                                            <th>Hombres<br> Total <br>Jornales</th>
                                                            <th>Hombres<br>18 a 29<br>Temporales</th>
                                                            <th>Hombres<br> >= 30 <br>Temporales</th>
                                                            <th>Hombres<br> Total <br>Temporales</th>
                                                            <th>Hombres<br>18 a 29<br>Permanentes</th>
                                                            <th>Hombres<br> >= 30 <br>Permanentes</th>
                                                            <th>Hombres<br> Total <br>Permanentes</th>
                                                            <th>Total<br>Jornales</th>
                                                            <th>Total<br>Temporales</th>
                                                            <th>Total<br>Permanentes</th>
                                                            <th></th>
                                                        </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="separator"></div>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                            <% if (id != 0) { %>
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <div class="card-title">Registro de Detalle de Empleos</div>
                                        </div>
                                        <div class="card-body">
                                            <form class="row g-4" id="frmempleos_detalle">
                                                <div class="col-sm-12 col-md-6">
                                                    <label for="codorganizacion" class="input-group-text">Organización</label>
                                                    <select class="form-select form-select-sm" required name="codorganizacion" id="codorganizacion"></select>
                                                </div>
                                                <div class="col-sm-12 col-md-6">
                                                    <label for="codcomunidadlinguistica" class="input-group-text">Comunidad Lingüística</label>
                                                    <select class="form-select form-select-sm" required name="codcomunidadlinguistica" id="codcomunidadlinguistica"></select>
                                                </div>
                                                <div class="col-sm-12 col-md-12">
                                                    <label for="codproducto" class="input-group-text">Producto</label>
                                                    <select class="form-select form-select-sm" required name="codproducto" id="codproducto"></select>
                                                </div>
                                                <div class="col-sm-12 col-md-6  ">
                                                    <label class="input-group-text" for="muj_18_29_jorn">Mujeres 18-29 Jornales</label>
                                                    <input class="form-control" type="number" name="muj_18_29_jorn" id="muj_18_29_jorn" value="0" required>
                                                </div>
                                                <div class="col-sm-12 col-md-6 ">
                                                    <label class="input-group-text" for="muj_30_99_jorn">Mujeres >= 30 Jornales</label>
                                                    <input class="form-control" type="number" name="muj_30_99_jorn" id="muj_30_99_jorn" value="0" required>
                                                </div>
                                                <div class="col-sm-12 col-md-6 ">
                                                    <label class="input-group-text" for="muj_18_29_temp">Mujeres 18-29 Temporales</label>
                                                    <input class="form-control" type="number" name="muj_18_29_temp" id="muj_18_29_temp" value="0" required>
                                                </div>
                                                <div class="col-sm-12 col-md-6 ">
                                                    <label class="input-group-text" for="muj_30_99_temp">Mujeres >= 30 Temporales</label>
                                                    <input class="form-control" type="number" name="muj_30_99_temp" id="muj_30_99_temp" value="0" required>
                                                </div>
                                                <div class="col-sm-12 col-md-6 ">
                                                    <label class="input-group-text" for="muj_18_29_perm">Mujeres 18-29 Permanentes</label>
                                                    <input class="form-control" type="number" name="muj_18_29_perm" id="muj_18_29_perm" value="0" required>
                                                </div>
                                                <div class="col-sm-12 col-md-6 ">
                                                    <label class="input-group-text" for="muj_30_99_perm">Mujeres >= 30 Permanentes</label>
                                                    <input class="form-control" type="number" name="muj_30_99_perm" id="muj_30_99_perm" value="0" required>
                                                </div>
                                                <div class="col-sm-12 col-md-6 ">
                                                    <label class="input-group-text" for="hom_18_29_jorn">Hombres 18-29 Jornales</label>
                                                    <input class="form-control" type="number" name="hom_18_29_jorn" id="hom_18_29_jorn" value="0" required>
                                                </div>
                                                <div class="col-sm-12 col-md-6 ">
                                                    <label class="input-group-text" for="hom_30_29_jorn">Hombres >= 30 Jornales</label>
                                                    <input class="form-control" type="number" name="hom_30_99_jorn" id="hom_30_29_jorn" value="0" required>
                                                </div>
                                                <div class="col-sm-12 col-md-6 ">
                                                    <label class="input-group-text" for="hom_18_29_temp">Hombres 18-29 Temporales</label>
                                                    <input class="form-control" type="number" name="hom_18_29_temp" id="hom_18_29_temp" value="0" required>
                                                </div>
                                                <div class="col-sm-12 col-md-6 ">
                                                    <label class="input-group-text" for="hom_30_99_temp">Hombres >= 30 Temporales</label>
                                                    <input class="form-control" type="number" name="hom_30_99_temp" id="hom_30_99_temp" value="0" required>
                                                </div>
                                                <div class="col-sm-12 col-md-6 ">
                                                    <label class="input-group-text" for="hom_18_29_perm">Hombres 18-29 Permanentes</label>
                                                    <input class="form-control" type="number" name="hom_18_29_perm" id="hom_18_29_perm" value="0" required>
                                                </div>
                                                <div class="col-sm-12 col-md-6 ">
                                                    <label class="input-group-text" for="hom_30_99_perm">Hombres >= 30 Permanentes</label>
                                                    <input class="form-control" type="number" name="hom_30_99_perm" id="hom_30_99_perm" value="0" required>
                                                </div>
                                                <div class="col-sm-12 col-md-4">
                                                   <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <label for="codsecuencia" class="input-group-text">#</label>
                                                        </div>
                                                        <input type="number" class="form-control form-control-sm"
                                                               required readonly
                                                               value="0"
                                                               name="codsecuencia" id="codsecuencia">
                                                    </div>
                                                </div>
                                                <div class="col-sm-12 col-md-4">
                                                    <button type="submit" id="kt_submit_frmdetalleempleos"
                                                            class="btn col-12 btn-success">
                                                        <span class="indicator-label"><i class="bi bi-save"></i>Guardar</span>
                                                        <span class="indicator-progress">Procesando...
                                                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                                    </span>
                                                    </button>
                                                </div>
                                                <div class="col-sm-12 col-md-4">
                                                    <button type="button" id="kt_delete_frmdetalleempleos"
                                                            class="btn col-12 btn-danger">
                                                        <span class="indicator-label"><i class="bi bi-trash"></i>Borrar</span>
                                                        <span class="indicator-progress">Procesando...
                                                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                                        </span>
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            <% } %>
                        </div>

                    </div>
                </div>
            </div>
            <%- include('../components/bottom-footer.ejs', {ip: ip}) %>
        </div>
    </div>
</div>

<%- include('../components/kt-scrolltop.ejs') %>
<%- include('../components/web-footer.ejs') %>
<script>
	const url = `${window.location.origin}/api`;
	const codSocio = '<%- UserInfo.codsocio %>';
	const codRole = '<%- UserInfo.codrole %>'
	const codPais = '<%- UserInfo.codpais %>'
	const filtSocioUrl = codRole == 1 ? '': `/codsocio/${codSocio}`;
	let codactividad = $("#codactividad")
	var dataCodActividades;
	const codempleo = '<%- id || 0 %>';
	const form_empleos = $("#frmempleos");
	const submitHeader = document.querySelector('#kt_submit_frmempleos');
	const poaSelectedString = '<%- poaString %>';
	const poaSelected = JSON.parse(poaSelectedString);

	let poaActividadSel = poaSelected.map(function(value, index){
		return value.codactividad
	})

	/* :::BEGIN::: */
	let sToast = Swal.mixin({
		toast: true,
		position: "top-end",
		showConfirmButton: false,
		timer: 3000,
		timerProgressBar: true,
		didOpen: (toast) => {
			toast.onmouseenter = Swal.stopTimer;
			toast.onmouseleave = Swal.resumeTimer;
		}
	})

	function fnToast(res) {
		const {code, message} = res

		if (code == undefined) {
			console.error(res)
			throw 'Formato invalido'
		}
		sToast.fire({
			icon: code == 'true' ? 'success' : 'error',
			title: message
		})
	}

	function delBase(message, path) {
		Swal.fire({
			text: message,
			showCancelButton: true,
			icon: "warning",
			buttonsStyling: false,
			confirmButtonText: "Eliminar",
			cancelButtonText: "Cancelar",
			customClass: {
				confirmButton: "order-2 btn btn-danger",
				cancelButton: "order-1 btn btn-light"
			}
		}).then(function (action) {
			if (action.isConfirmed) {
				buttonDeleteDetalle.setAttribute('data-kt-indicator', 'on');
				buttonDeleteDetalle.disabled = true;
				$.ajax({
					url: `${url}/catalogo/${path}`,
					type: 'delete'
				}).done(function (request) {
					sToast.fire({
						icon: "success",
						title: "Registro Eliminado"
					})
					tableDetalle.ajax.reload(null, false);
				}).fail(function (reason) {
					console.log(reason)
					sToast.fire({
						icon: "error",
						title: "Se produjo un error"
					})
				}).always(function(){
					buttonDeleteDetalle.removeAttribute('data-kt-indicator')
					buttonDeleteDetalle.disabled = false;
                })
			}
		})
	}

	function upBase(message, icon, path, data) {
		Swal.fire({
			text: message,
			showCancelButton: true,
			icon: icon,
			buttonsStyling: false,
			confirmButtonText: "Procesar"
		})
	}
	let GTQ = new Intl.NumberFormat('es-GT', {
		style: 'currency',
		currency: 'GTQ'
	})
	let USD = new Intl.NumberFormat('us-US', {
		style: 'currency',
		currency: 'USD'
	})

	/* :::END::: */

	$.ajax({
		url: `${url}/catalogo/select2/poa.vw_actividad_proyecto_estrategia_busqueda/codactividad/stractividad`,
		type: 'get',
		dataType: 'json',
		data: {
			colname: 'codsocio',
			colvalue: `${codSocio}`
		}
	}).done(function(result){
		dataCodActividades = result.results;
		codactividad.select2({
			placeholder: "Seleccione una actividad",
			data: dataCodActividades,
			templateResult: function(data){
				if (!data.id)
					return data.text;
				const [stractividad, strproyecto, strestrategia] = data.text.split('|')
				let template = ""
				template += `<div>`
				template += `<p class="fw-bold small mb-1"> <span class="badge badge-success">${strproyecto}</span> <span class="badge badge-primary">${strestrategia}</span></p>`
				template += `<p class="mb-0 fw-bold">${stractividad}</p>`
				template += `</div>`
				return $(`${template}`)
			},
			templateSelection: function(result) {
				const [stractividad, strproyecto, strestrategia] = result.text.split('|')
				let template = ""
				template += `<div>`
				template += `<p class="fw-bold small mb-1"><span class="badge badge-success">${strproyecto}</span> <span class="badge badge-primary">${strestrategia}</span></p>`
				template += `<p class="mb-0 fw-bold">${stractividad}</p>`
				template += `</div>`
				return $(`${template}`)
			}
		})
		codactividad.val(poaActividadSel).trigger('change')
	})

	form_empleos.submit(function (e) {
		e.preventDefault();
		submitHeader.disabled = true;
		submitHeader.setAttribute('data-kt-indicator', 'on');

		let method = codempleo != 0 ? 'put' : 'post';

		$.ajax({
			url: `${url}/mye/empleos/registro/${codempleo}`,
			type: `${method}`,
			data: form_empleos.serializeArray()
		}).done(function (result) {
			const { code, message, data } = result;
			const { CodEmpleo } = data[0];
            console.log('datas', data)
			fnToast({
				code: code != undefined ? 'true' : '500',
				message: code != undefined ? message : 'No se puede leer el mensaje del servidor'
			});

			setTimeout(function () {
				submitHeader.disabled = false;
				submitHeader.removeAttribute('data-kt-indicator');
				window.location.href = "/mye/empleos/registro/" + CodEmpleo;
			}, 500);
		}).fail(function (reason) {
			console.log(reason);
			const { code, message } = reason.responseJSON;
			fnToast({
				code: '500',
				message: code != undefined ? message : 'Se produjo un error al guardar'
			});
			submitHeader.disabled = false;
			submitHeader.removeAttribute('data-kt-indicator');
		});
	});
<% if (id != 0) { %>
    /* CODIGO PARA REGISTRAR EL DETALLE */
	var dataOrganizaciones = []
	var dataProducto = []
	var dataComunidadLinguistica = []
	var formDetalle = $("#frmempleos_detalle")
	var inputsDetalle = {
		codsecuencia: $("#codsecuencia"),
		codorganizacion: $("#codorganizacion"),
		codproducto: $("#codproducto"),
		codcomunidadlinguistica: $("#codcomunidadlinguistica"),
		muj_18_29_jorn: $("#muj_18_29_jorn"),
		muj_30_99_jorn: $("#muj_30_99_jorn"),
		muj_18_29_temp: $("#muj_18_29_temp"),
		muj_30_99_temp: $("#muj_30_99_temp"),
		muj_18_29_perm: $("#muj_18_29_perm"),
		muj_30_99_perm: $("#muj_30_99_perm"),
		hom_18_29_jorn: $("#hom_18_29_jorn"),
		hom_30_99_jorn: $("#hom_30_99_jorn"), // Corregido
		hom_18_29_temp: $("#hom_18_29_temp"),
		hom_30_99_temp: $("#hom_30_99_temp"), // Corregido
		hom_18_29_perm: $("#hom_18_29_perm"),
		hom_30_99_perm: $("#hom_30_99_perm") // Corregido

	}
	var buttonSubmitDetalle = document.querySelector('#kt_submit_frmdetalleempleos')
	var buttonDeleteDetalle = document.querySelector('#kt_delete_frmdetalleempleos')
	buttonDeleteDetalle.style.display = "none";
	var tableDetalle

	function delEmpleoDetalle(id){
		delBase('¿Esta seguro que desea eliminar este registro?', `empleos.detalle/codsecuencia/${id}`)
        cleanFormDetalle()
	}

	$.ajax({
		url: `${url}/catalogo/select2/organizacion.core/codorganizacion/strnombre`,
		type: 'get'
	}).done(function(result){
		dataOrganizaciones = result.results;
		$("#codorganizacion").select2({
			placeholder: "Seleccione organizacion",
			data: dataOrganizaciones,
			templateResult: function(data){
				if (!data.id)
					return data.text;
				let template = ""
				template += `<p class="mb-0 fw-bold small">${data.text}</p>`
				return $(`${template}`)
			},
			templateSelection: function(result) {
				return $(`<div class="small fw-bold ">${result.text}</div>`)
			}
		})
	})
	$.ajax({
		url: `${url}/catalogo/select2/cadenavalor.vw_producto_busqueda/codproducto/strfullproducto`,
		type: 'get'
	}).done(function(result){
		dataProducto = result.results;
		$("#codproducto").select2({
			placeholder: "Seleccione un producto",
			data: dataProducto,
			templateResult: function(data){
				if (!data.id)
					return data.text;
				const [categoria, cadena, producto] = data.text.split('|')
				let template = `<div>`
				template += `<p class="mb-1 small "><span class="badge badge-secondary"><small>${categoria}</small></span> <span class="badge badge-secondary"><small>${cadena}</small></span></p>`
				template += `<p class="mb-0 small fw-bold">${producto}</p>`
				template += `</div>`
				return $(`${template}`)
			},
			templateSelection: function(result) {
				const [categoria, cadena, producto] = result.text.split('|')
				let template = `<div>`
				template += `<p class="mb-1 small"><span class="badge badge-secondary"><small>${categoria}</small></span> <span class="badge badge-secondary"><small>${cadena}</small></span></p>`
				template += `<p class="mb-0 small fw-bold">${producto}</p>`
				template += `</div>`
				return $(`${template}`)
			}
		})
	})
	$.ajax({
		url: `${url}/catalogo/select2/geografica.comunidad_linguistica/codcomunidadl/strcomunidadl`,
		type: 'get',
        data: {
			colname: 'codpais',
            colvalue: `${codPais}`
        }
	}).done(function(result){
		dataComunidadLinguistica = result.results;
		$("#codcomunidadlinguistica").select2({
			placeholder: "Seleccione una comunidad linguistica",
			data: dataComunidadLinguistica,
			templateResult: function(data){
				if (!data.id)
					return data.text;
				let template = ""
				template += `<p class="mb-0 fw-bold small">${data.text}</p>`
				return $(`${template}`)
			},
			templateSelection: function(result) {
				return $(`<div class="small fw-bold ">${result.text}</div>`)
			}
		})
	})
	function cleanFormDetalle(){
		formDetalle.trigger('reset')
		inputsDetalle.codsecuencia.val('0')
		inputsDetalle.codorganizacion.val(null).trigger('change')
		inputsDetalle.codproducto.val(null).trigger('change')
		inputsDetalle.codcomunidadlinguistica.val(null).trigger('change')
	}

	formDetalle.submit(function(e){
		e.preventDefault()
		buttonSubmitDetalle.setAttribute('data-kt-indicator', 'on');
		buttonSubmitDetalle.disabled = true;

		let method = inputsDetalle.codsecuencia.val() != 0 ? 'put' : 'post'

		$.ajax({
			url: `${url}/mye/empleos/detalle/${codempleo}`,
			type: `${method}`,
			data: formDetalle.serializeArray()
		}).done(function(result){
			const {code, message, data} = result
			fnToast({
				code: code != undefined ? 'true' : '500',
				message: code != undefined ? message: 'No se puede leer el mensaje del servidor'
			})
			tableDetalle.ajax.reload(null, false)
			cleanFormDetalle()
		}).fail(function(reason){
			let sms = "Error al guardar el detalle";
			if (reason.responseJSON)
				sms = reason.responseJSON.message

			console.log('no se pudo guardar', reason)
			fnToast({
				code: 'false',
				message: sms
			})
		}).always(function(){
			buttonSubmitDetalle.removeAttribute('data-kt-indicator')
			buttonSubmitDetalle.disabled = false
			buttonDeleteDetalle.style.display = "none";
		})
	})

	tableDetalle = $("#tb-empleoDetalle").DataTable({
		search: false,
		ajax: `${url}/catalogo/view/empleos.vw_detalle/codempleo/${codempleo}`,
		columns: [
			{data: "codsecuencia"},
			{data: "strorganizacion"},
			{data: "strproducto"},
			{data: "strcomunidadlinguistica"},
			{data: "muj_18_29_jorn"},
			{data: "muj_30_99_jorn"},
			{data: "sum_muj_jorn"},
			{data: "muj_18_29_temp"},
			{data: "muj_30_99_temp"},
			{data: "sum_muj_temp"},
			{data: "muj_18_29_perm"},
			{data: "muj_30_99_perm"},
			{data: "sum_muj_perm"},
			{data: "hom_18_29_jorn"},
			{data: "hom_30_99_jorn"},
			{data: "sum_hom_jorn"},
			{data: "hom_18_29_temp"},
			{data: "hom_30_99_temp"},
			{data: "sum_hom_temp"},
			{data: "hom_18_29_perm"},
			{data: "hom_30_99_perm"},
			{data: "sum_hom_perm"},
			{data: "sum_tot_jorn"},
			{data: "sum_tot_temp"},
			{data: "sum_tot_perm"},
			{data: null}
		],
		columnDefs: [
			{
				targets: [2],
				render: function(data, type, row) {
					return `${row.strcategoria}/${row.strcadenavalor}/${data}`
				}
			},{
				targets: [25],
                visible: false,
				render: function(data, type, row) {
					let s0 = `<button onclick="delEmpleoDetalle('${row.codsecuencia}')" class="btn btn-icon btn-circle btn-light-danger"><i class="bi bi-trash"></i></button>`
					return `${s0}`
				}
			}
		]
	})

    tableDetalle.on('click', 'tbody tr', function(e){
		let classList = e.currentTarget.classList;
		var data = tableDetalle.row(this).data();
		if (data != undefined)
			if (classList.contains('selected')) {
				classList.remove('selected');
				buttonDeleteDetalle.style.display = "none";
				cleanFormDetalle()
			}
			else {
				tableDetalle.rows('.selected').nodes().each((row) => row.classList.remove('selected'));
				classList.add('selected');
				buttonDeleteDetalle.style.display = "block";
				fillDetalleWithSelect(data)
			}
    })

	buttonDeleteDetalle.addEventListener('click', function(){
		const id = inputsDetalle.codsecuencia.val()
		delEmpleoDetalle(id)
	})

    function fillDetalleWithSelect(data){
		if (data != undefined) {
			inputsDetalle.codsecuencia.val(data.codsecuencia)
			inputsDetalle.codorganizacion.val(data.codorganizacion).trigger('change')
			inputsDetalle.codcomunidadlinguistica.val(data.codcomunidadlinguistica).trigger('change')
			inputsDetalle.codproducto.val(data.codproducto).trigger('change')

			// Asignación directa para campos muj_*
			inputsDetalle.muj_18_29_jorn.val(data.muj_18_29_jorn);
			inputsDetalle.muj_30_99_jorn.val(data.muj_30_99_jorn);
			inputsDetalle.muj_18_29_temp.val(data.muj_18_29_temp);
			inputsDetalle.muj_30_99_temp.val(data.muj_30_99_temp);
			inputsDetalle.muj_18_29_perm.val(data.muj_18_29_perm);
			inputsDetalle.muj_30_99_perm.val(data.muj_30_99_perm);

			// Asignación directa para campos hom_*
			inputsDetalle.hom_18_29_jorn.val(data.hom_18_29_jorn);
			inputsDetalle.hom_30_99_jorn.val(data.hom_30_99_jorn);
			inputsDetalle.hom_18_29_temp.val(data.hom_18_29_temp);
			inputsDetalle.hom_30_99_temp.val(data.hom_30_99_temp);
			inputsDetalle.hom_18_29_perm.val(data.hom_18_29_perm);
			inputsDetalle.hom_30_99_perm.val(data.hom_30_99_perm);
		}
	}


<% } %>
</script>
</body>
</html>
